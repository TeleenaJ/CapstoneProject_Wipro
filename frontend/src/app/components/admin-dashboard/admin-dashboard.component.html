<div class="admin-dashboard">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Dashboard</h2>
    <button mat-raised-button color="primary" (click)="loadDashboardData()">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="text-center py-5">
    <mat-spinner></mat-spinner>
    <p class="mt-3">Loading dashboard data...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading">
    <!-- Summary Cards -->
    <div class="row mb-4">
      <div class="col-lg-3 col-md-6 mb-3">
        <mat-card class="stat-card products-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>inventory</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{ dashboardData.total_products }}</div>
                <div class="stat-label">Total Products</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="col-lg-3 col-md-6 mb-3">
        <mat-card class="stat-card orders-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>receipt_long</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{ dashboardData.total_orders }}</div>
                <div class="stat-label">Total Orders</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="col-lg-3 col-md-6 mb-3">
        <mat-card class="stat-card revenue-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>attach_money</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">â‚¹{{ dashboardData.total_revenue.toFixed(2) }}</div>
                <div class="stat-label">Total Revenue</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="col-lg-3 col-md-6 mb-3">
        <mat-card class="stat-card stock-card">
          <mat-card-content>
            <div class="stat-content">
              <div class="stat-icon">
                <mat-icon>warning</mat-icon>
              </div>
              <div class="stat-info">
                <div class="stat-number">{{ dashboardData.low_stock_products }}</div>
                <div class="stat-label">Low Stock Items</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <div class="row">
      <!-- Order Status Breakdown -->
      <div class="col-lg-6 mb-4">
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Order Status Breakdown</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="status-breakdown">
              <div *ngFor="let status of getOrderStatusKeys()" 
                   class="status-item">
                <div class="status-info">
                  <span class="status-badge" [ngClass]="getStatusClass(status)">
                    {{ status | titlecase }}
                  </span>
                  <span class="status-count">{{ dashboardData.order_status_counts[status] }}</span>
                </div>
                <div class="status-bar">
                  <div class="status-progress" 
                       [style.width.%]="(dashboardData.order_status_counts[status] / dashboardData.total_orders) * 100"
                       [ngClass]="getStatusClass(status)">
                  </div>
                </div>
              </div>
            </div>
            
            <div *ngIf="getOrderStatusKeys().length === 0" class="text-center text-muted py-4">
              No orders found
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Low Stock Items -->
      <div class="col-lg-6 mb-4">
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Low Stock Alert</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="low-stock-list">
              <div *ngFor="let item of dashboardData.low_stock_items" class="stock-item">
                <div class="item-info">
                  <div class="item-name">{{ item.name }}</div>
                  <div class="item-category text-muted">{{ item.category }}</div>
                </div>
                <div class="stock-level">
                  <span class="stock-number" 
                        [class.critical]="item.stock < 5"
                        [class.warning]="item.stock >= 5 && item.stock < 10">
                    {{ item.stock }} left
                  </span>
                </div>
              </div>
            </div>
            
            <div *ngIf="dashboardData.low_stock_items.length === 0" class="text-center text-muted py-4">
              All products are well stocked!
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Recent Orders -->
    <div class="row">
      <div class="col-12">
        <mat-card class="recent-orders-card">
          <mat-card-header>
            <mat-card-title>Recent Orders</mat-card-title>
            <div class="spacer"></div>
            <button mat-button routerLink="/admin/orders">
              View All Orders
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Total</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let order of dashboardData.recent_orders">
                    <td><strong>#{{ order.id }}</strong></td>
                    <td>{{ order.created_at | date:'short' }}</td>
                    <td>{{ order.user_id }}</td>
                    <td class="text-success">${{ order.total_amount.toFixed(2) }}</td>
                    <td>
                      <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                        {{ order.status | titlecase }}
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div *ngIf="dashboardData.recent_orders.length === 0" class="text-center text-muted py-4">
              No recent orders found
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>



